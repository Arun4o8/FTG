<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fix the Glitch | Access Terminal</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #09090b;
            --surface: #18181b;
            --primary: #22c55e;
            --primary-glow: rgba(34, 197, 94, 0.4);
            --text: #f4f4f5;
            --text-muted: #a1a1aa;
            --border: #27272a;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background-color: var(--bg);
            color: var(--text);
            font-family: 'Share Tech Mono', monospace;
            padding: 20px;
            user-select: none;
            /* Prevent text selection */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .glitch-title {
            font-size: 2.5rem;
            text-align: center;
            color: var(--primary);
            text-transform: uppercase;
            margin-bottom: 30px;
            text-shadow: 0 0 10px var(--primary-glow);
            letter-spacing: 2px;
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary);
        }

        input {
            width: 100%;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            color: var(--text);
            font-family: inherit;
            font-size: 16px;
            border-radius: 4px;
            transition: 0.3s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 5px var(--primary-glow);
        }

        .btn {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 12px 24px;
            font-family: inherit;
            font-size: 18px;
            cursor: pointer;
            text-transform: uppercase;
            width: 100%;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: var(--primary);
            color: var(--bg);
            box-shadow: 0 0 15px var(--primary-glow);
        }

        .option {
            display: block;
            padding: 15px;
            border: 1px solid var(--border);
            margin-bottom: 10px;
            border-radius: 4px;
            cursor: pointer;
            transition: 0.2s;
            background: var(--bg);
        }

        .option:hover {
            border-color: var(--primary);
        }

        .option.selected {
            background: rgba(34, 197, 94, 0.1);
            border-color: var(--primary);
        }

        .option input {
            display: none;
        }

        .hidden {
            display: none !important;
        }

        pre {
            background: #000;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            margin-bottom: 15px;
            border: 1px solid #333;
        }

        code {
            font-family: 'Share Tech Mono', monospace;
            color: #eab308;
        }

        .loader {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .hacker-timer {
            position: fixed;
            top: 70px;
            right: 25px;
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid var(--primary);
            padding: 10px 15px;
            z-index: 1000;
            box-shadow: 0 0 10px var(--primary-glow);
            text-shadow: 0 0 5px var(--primary);
            font-family: 'Share Tech Mono', monospace;
            border-radius: 4px;
        }

        /* FTG Glitch Effect */
        .ftg-logo {
            position: fixed;
            top: 20px;
            right: 25px;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            z-index: 9999;
            letter-spacing: 2px;
            text-shadow: 0 0 10px var(--primary-glow);
            user-select: none;
            cursor: default;
        }

        .ftg-logo::before,
        .ftg-logo::after {
            content: "FTG";
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.8;
        }

        .ftg-logo::before {
            color: #0ff;
            z-index: -1;
            animation: glitch-anim-1 0.2s infinite linear alternate-reverse;
        }

        .ftg-logo::after {
            color: #f0f;
            z-index: -2;
            animation: glitch-anim-2 0.3s infinite linear alternate-reverse;
        }

        @keyframes glitch-anim-1 {
            0% {
                transform: translate(0)
            }

            25% {
                transform: translate(-2px, 1px)
            }

            50% {
                transform: translate(-1px, -1px)
            }

            75% {
                transform: translate(2px, 1px)
            }

            100% {
                transform: translate(1px, -1px)
            }
        }

        @keyframes glitch-anim-2 {
            0% {
                transform: translate(0)
            }

            25% {
                transform: translate(2px, -1px)
            }

            50% {
                transform: translate(1px, 1px)
            }

            75% {
                transform: translate(-2px, -1px)
            }

            100% {
                transform: translate(-1px, 1px)
            }
        }
    </style>
</head>

<body>
    <!-- FTG Logo with Glitch Effect -->
    <div class="ftg-logo" title="Fix The Glitch">FTG</div>
    <div class="container">
        <h1 class="glitch-title">FIX_THE_GLITCH();</h1>

        <div id="loading" class="card" style="text-align: center;">
            <p>> Establishing connection to mainframe...</p>
            <p>> Downloading glitch fragments...</p>
            <div class="loader"></div>
        </div>

        <!-- Landing Screen -->
        <div id="landing-screen" class="hidden card" style="text-align: center;">
            <h2 style="color: var(--primary); margin-bottom: 20px;">> SECURE_TEST_ENVIRONMENT</h2>
            <p id="landing-error"
                style="color: #ef4444; margin-bottom: 15px; font-weight: bold; border: 1px solid #ef4444; padding: 10px; border-radius: 4px;"
                class="hidden"></p>
            <p style="margin-bottom: 20px; color: var(--text-muted);">Please enter full-screen mode to access the
                participant initialization form and proceed to the test.</p>
            <button class="btn" id="enter-fullscreen-btn">ENTER_FULLSCREEN_MODE</button>
        </div>

        <!-- Start Screen -->
        <div id="start-screen" class="hidden">
            <div class="card">
                <h2 style="margin-bottom: 15px; color: var(--primary);">> INITIALIZE_PARTICIPANT</h2>
                <div class="form-group">
                    <label>> enter_full_name:</label>
                    <input type="text" id="name" placeholder="_" required>
                </div>
                <div class="form-group">
                    <label>> enter_college:</label>
                    <input type="text" id="college" placeholder="_" required>
                </div>
                <div class="form-group">
                    <label>> enter_department:</label>
                    <input type="text" id="dept" placeholder="_" required>
                </div>
                <div class="form-group">
                    <label>> enter_email:</label>
                    <input type="email" id="mail" placeholder="_" required>
                </div>
                <div class="form-group">
                    <label>> enter_phone_number:</label>
                    <input type="tel" id="phone" placeholder="_" required>
                </div>
                <button class="btn" id="start-btn">ACCESS_GRANTED</button>
                <p id="start-error" style="color: #ef4444; margin-top: 10px;" class="hidden">Error: Core logic failure.
                    Invalid parameters.</p>
            </div>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="hidden">
            <div id="timer-display" class="hacker-timer">
                [ T-MINUS: 30:00 ]
            </div>

            <h2 id="category-title" class="card"
                style="color: #eab308; margin-bottom: 20px; text-transform: uppercase;"></h2>
            <div id="questions-container"></div>

            <div class="card" style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn hidden" id="prev-btn" style="flex: 1;">&lt; PREVIOUS_PHASE</button>
                <button class="btn" id="next-btn" style="flex: 1;">NEXT_PHASE &gt;</button>
                <button class="btn hidden" id="submit-btn" style="flex: 1;">EXECUTE_COMPILE();</button>
                <p id="submit-error" style="color: #ef4444; margin-top: 10px; width: 100%; text-align: center;"
                    class="hidden">Error: Unanswered variables found in sequence.</p>
                <div id="submit-loader" class="hidden"
                    style="width: 100%; text-align: center; font-family: 'Share Tech Mono', monospace; font-size: 1.2rem; color: #0ff; text-shadow: 0 0 5px #0ff; padding: 15px;">
                    > UPLOADING_PAYLOAD: <span id="progress-bar">[..........]</span>
                </div>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="hidden card" style="text-align: center;">
            <h2 style="color: var(--primary); font-size: 2rem; margin-bottom: 10px;">> COMPILATION_SUCCESS</h2>
            <p style="margin-bottom: 20px; color: var(--text-muted);">Process ended with exit code 0.</p>
            <div style="font-size: 1.5rem; margin-bottom: 10px;">
                Participant: <span id="res-name" style="color: var(--primary);"></span>
            </div>
            <!-- Score hidden per admin request -->
            <div class="hidden">
                <span id="res-score"></span> / <span id="res-total"></span>
            </div>
            <p style="color: var(--primary); font-size: 1.2rem; margin: 20px 0;">> TEST_SUBMITTED_SUCCESSFULLY</p>
            <p style="color: var(--text-muted);">> Data successfully pushed to admin terminal.</p>
        </div>

        <!-- Global Scores Screen -->
        <div id="scores-screen" class="hidden card">
            <h2 style="color: var(--primary); text-align: center; margin-bottom: 20px;">> GLOBAL_LEADERBOARD</h2>
            <div style="overflow-x: auto;">
                <table id="public-scores-table" style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr>
                            <th
                                style="padding: 10px; border-bottom: 1px solid var(--border); color: var(--primary); text-align: left;">
                                Rank</th>
                            <th
                                style="padding: 10px; border-bottom: 1px solid var(--border); color: var(--primary); text-align: left;">
                                Name</th>
                            <th
                                style="padding: 10px; border-bottom: 1px solid var(--border); color: var(--primary); text-align: left;">
                                Score</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
            <button class="btn" style="margin-top: 20px;" onclick="closeScores()">RETURN</button>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyet4FC3zq5nhy95hXqkQUYSDdTTiCn1xJ0Ig91rpQAXb3qmdw-uc28RXkl_Wst-f4tkg/exec';

        let questions = [];
        let userAnswers = [];
        let timerInterval;
        let isDeskLocked = false;
        let uniqueCategories = [];
        let currentCategoryIndex = 0;

        // Hardcoded questions. If you don't want to use Google Sheets for questions, 
        // you can just type your questions right here in the code!
        const fallbackQuestions = [
            { "title": "Python", "q": "Who created Python?", "opts": ["Dennis Ritchie", "Guido van Rossum", "James Gosling", "Bjarne Stroustrup"], "ans": 1 },
            { "title": "Python", "q": "Which keyword is used to define a function in Python?", "opts": ["function", "define", "def", "fun"], "ans": 2 },
            { "title": "Python", "q": "Which of the following is a mutable data type?", "opts": ["tuple", "string", "list", "int"], "ans": 2 },
            { "title": "Python", "q": "What is the output? print(type(5))", "opts": ["int", "<class 'int'>", "integer", "type int"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nx = [1,2,3]\nprint(x * 2)", "opts": ["[2,4,6]", "[1,2,3,1,2,3]", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "Which method is used to add an element to a list?", "opts": ["add()", "insert()", "append()", "push()"], "ans": 2 },
            { "title": "Python", "q": "What is the output?\nprint(\"5\" + \"3\")", "opts": ["8", "53", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What happens here?\nx = (1,2,[3,4])\nx[2].append(5)\nprint(x)", "opts": ["Error", "(1,2,[3,4])", "(1,2,[3,4,5])", "None"], "ans": 2 },
            { "title": "Python", "q": "What is the output?\ndef func(x=[]):\n    x.append(1)\n    return x\nprint(func())\nprint(func())", "opts": ["[1] and [1]", "[1] and [1,1]", "Error", "[] and [1]"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\na = [1,2,3]\nb = a\na += [4]\nprint(b)", "opts": ["[1,2,3]", "[1,2,3,4]", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What will be printed?\nprint(bool([]))", "opts": ["True", "False", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\na = \"Python\"\nprint(a[1:4])", "opts": ["Pyt", "yth", "tho", "Error"], "ans": 1 },
            { "title": "Python", "q": "Which statement is used for exception handling?", "opts": ["try-except", "try-catch", "catch", "handle"], "ans": 0 },
            { "title": "Python", "q": "What is the output?\nx = 5\ndef func():\n    x = 10\nfunc()\nprint(x)", "opts": ["10", "5", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint(2 ** 4)", "opts": ["8", "16", "6", "4"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint(0.1 + 0.2 == 0.3)", "opts": ["True", "False", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint({True: \"yes\", 1: \"no\", 1.0: \"maybe\"})", "opts": ["{True:'yes',1:'no',1.0:'maybe'}", "{True:'maybe'}", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nfor i in range(3):\n    def f():\n        return i\nprint(f())", "opts": ["0", "1", "2", "Error"], "ans": 2 },
            { "title": "Python", "q": "What is the output?\nprint(list(filter(None, [0, 1, False, True, \"\", \"Python\"])))", "opts": ["[0, False, \"\"]", "[1, True, \"Python\"]", "All values", "Error"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\na = [1,2,3]\nb = a[:]\nprint(a is b)", "opts": ["True", "False", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nx = [1, 2, 3]\nprint(x[-1])", "opts": ["1", "2", "3", "Error"], "ans": 2 },
            { "title": "Python", "q": "What does len({\"a\":1, \"b\":2}) return?", "opts": ["1", "2", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "Which keyword is used to create a class in Python?", "opts": ["struct", "object", "class", "define"], "ans": 2 },
            { "title": "Python", "q": "What is the output?\nprint(10 // 3)", "opts": ["3.33", "3", "4", "Error"], "ans": 1 },
            { "title": "Python", "q": "Which data type is unordered?", "opts": ["list", "tuple", "set", "string"], "ans": 2 },
            { "title": "Python", "q": "What is the output?\nprint(bool(\"False\"))", "opts": ["False", "True", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What does break do in a loop?", "opts": ["Skips iteration", "Stops loop", "Restarts loop", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nx = {1,2,3}\nx.add(2)\nprint(len(x))", "opts": ["4", "3", "Error", "2"], "ans": 1 },
            { "title": "Python", "q": "Which function converts string to integer?", "opts": ["str()", "float()", "int()", "chr()"], "ans": 2 },
            { "title": "Python", "q": "What is the output?\nprint(\"Hello\".lower())", "opts": ["HELLO", "hello", "Hello", "Error"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\na = [1,2,3]\nprint(sum(a))", "opts": ["6", "5", "Error", "None"], "ans": 0 },
            { "title": "Python", "q": "Which operator checks identity?", "opts": ["==", "is", "equals", "!="], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint(type({}))", "opts": ["list", "dict", "set", "tuple"], "ans": 1 },
            { "title": "Python", "q": "Which keyword is used to handle errors?", "opts": ["catch", "try", "handle", "error"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint(\"Python\"[::-1])", "opts": ["Python", "nohtyP", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint(3 * \"ab\")", "opts": ["ababab", "ab3", "Error", "None"], "ans": 0 },
            { "title": "Python", "q": "Which function reads input from user?", "opts": ["scan()", "input()", "read()", "get()"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nprint(5 > 3 and 2 < 1)", "opts": ["True", "False", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "What is the output?\nx = [1,2]\ny = x.copy()\nprint(x is y)", "opts": ["True", "False", "Error", "None"], "ans": 1 },
            { "title": "Python", "q": "Which keyword skips current iteration?", "opts": ["pass", "continue", "break", "skip"], "ans": 1 },

            // Java Questions
            { "title": "Java", "q": "What is the output?\nint x = 10;\nSystem.out.println(x++);\nSystem.out.println(x);", "opts": ["10 10", "11 11", "10 11", "11 10"], "ans": 2 },
            { "title": "Java", "q": "Find the error:\nSystem.out.println(\"Hello World\")", "opts": ["Missing semicolon", "Wrong method name", "Wrong class name", "No error"], "ans": 0 },
            { "title": "Java", "q": "What is the output?\nString s1 = \"Java\";\nString s2 = \"Java\";\nSystem.out.println(s1 == s2);", "opts": ["false", "true", "Compilation error", "Runtime error"], "ans": 1 },
            { "title": "Java", "q": "What happens?\nint arr[] = new int[3];\nSystem.out.println(arr[3]);", "opts": ["0", "null", "ArrayIndexOutOfBoundsException", "Compilation error"], "ans": 2 },
            { "title": "Java", "q": "What is the output?\nSystem.out.println(10 + 20 + \"Java\" + 10 + 20);", "opts": ["30Java1020", "30Java30", "1020Java1020", "Java102030"], "ans": 0 },
            { "title": "Java", "q": "What is printed?\nInteger a = 127;\nInteger b = 127;\nSystem.out.println(a == b);", "opts": ["true", "false", "Runtime error", "Compilation error"], "ans": 0 },
            { "title": "Java", "q": "What happens?\nint x = 5;\nif(x = 10)\nSystem.out.println(\"Yes\");\nelse\nSystem.out.println(\"No\");", "opts": ["Yes", "No", "Compilation error", "Runtime error"], "ans": 2 },
            { "title": "Java", "q": "What happens?\nfinal int x;\nSystem.out.println(x);", "opts": ["0", "Compilation error", "Runtime error", "null"], "ans": 1 },
            { "title": "Java", "q": "What is the output?\nString s = null;\nSystem.out.println(s.length());", "opts": ["0", "NullPointerException", "Compilation error", "null"], "ans": 1 },
            { "title": "Java", "q": "Which line causes error?\nList list = new ArrayList();\nlist.add(\"Java\");\nlist.add(10);\nString s = (String) list.get(1);", "opts": ["Line 1", "Line 2", "Line 3", "Line 4"], "ans": 3 },
            { "title": "Java", "q": "What is the output?\nParent p = new Child();\np.show();", "opts": ["Parent", "Child", "Compilation error", "Runtime error"], "ans": 0 },
            { "title": "Java", "q": "What is the output?\ntry {\nint a = 10/0;\n} catch(Exception e) {\nSystem.out.println(\"Exception\");\n} finally {\nSystem.out.println(\"Finally\");\n}", "opts": ["Exception", "Finally", "Exception Finally", "Runtime crash"], "ans": 2 },
            { "title": "Java", "q": "What happens?\nSystem.out.println(1/0);", "opts": ["0", "Infinity", "Runtime Exception", "Compilation error"], "ans": 2 },
            { "title": "Java", "q": "What is the output?\nString s = \"abc\";\ns.concat(\"def\");\nSystem.out.println(s);", "opts": ["abcdef", "abc", "Compilation error", "Runtime error"], "ans": 1 },
            { "title": "Java", "q": "What is the output?\nSystem.out.println('a' + 1);", "opts": ["a1", "b", "98", "Compilation error"], "ans": 2 },
            { "title": "Java", "q": "What is the output?\nint x = 0;\nSystem.out.println(x++ + ++x);", "opts": ["1", "2", "3", "4"], "ans": 1 },
            { "title": "Java", "q": "What happens?\nclass A { void m() throws Exception {} }\nclass B extends A { void m() throws java.io.IOException {} }", "opts": ["Compilation error", "Valid", "Runtime error", "Infinite loop"], "ans": 1 },
            { "title": "Java", "q": "What is the output?\nString s1 = new String(\"Java\");\nString s2 = \"Java\";\nSystem.out.println(s1 == s2);", "opts": ["true", "false", "Compilation error", "Runtime error"], "ans": 1 },
            { "title": "Java", "q": "What is the output?\nstatic {\nSystem.out.println(\"Static Block\");\n}\npublic static void main(String[] args) {\nSystem.out.println(\"Main\");\n}", "opts": ["Main Static Block", "Static Block Main", "Only Main", "Compilation error"], "ans": 1 },
            { "title": "Java", "q": "What is the output?\ntry {\nreturn;\n} finally {\nSystem.out.println(\"Finally\");\n}", "opts": ["Nothing prints", "Finally", "Runtime error", "Compilation error"], "ans": 1 },

            // C Questions
            { "title": "C", "q": "Which of the following is the correct extension of a C program file?", "opts": [".cpp", ".java", ".c", ".py"], "ans": 2 },
            { "title": "C", "q": "Which function is the entry point of a C program?", "opts": ["start()", "main()", "run()", "init()"], "ans": 1 },
            { "title": "C", "q": "Which of the following is a valid C data type?", "opts": ["integer", "int", "number", "decimal"], "ans": 1 },
            { "title": "C", "q": "Which symbol is used to end a statement in C?", "opts": [":", ".", ";", ","], "ans": 2 },
            { "title": "C", "q": "Which header file is required for printf()?", "opts": ["stdlib.h", "conio.h", "string.h", "stdio.h"], "ans": 3 },
            { "title": "C", "q": "What is the size of int in most 32-bit and 64-bit C compilers?", "opts": ["2 bytes", "4 bytes", "8 bytes", "Depends only on OS"], "ans": 1 },
            { "title": "C", "q": "What will be the output?\nint x = 5; printf(\"%d\", x++);", "opts": ["5", "6", "4", "Error"], "ans": 0 },
            { "title": "C", "q": "Which operator is used to access the value at an address (pointer dereferencing)?", "opts": ["&", "*", "%", "->"], "ans": 1 },
            { "title": "C", "q": "What will be the output?\nint a = 10, b = 20; printf(\"%d\", a > b);", "opts": ["0", "1", "10", "Error"], "ans": 0 },
            { "title": "C", "q": "Which loop executes at least once?", "opts": ["for", "while", "do-while", "None"], "ans": 2 },
            { "title": "C", "q": "What will be the output?\nchar str[] = \"Hello\"; printf(\"%lu\", sizeof(str));", "opts": ["5", "6", "4", "Error"], "ans": 1 },
            { "title": "C", "q": "Which function is used to dynamically allocate memory in C?", "opts": ["alloc()", "malloc()", "create()", "new"], "ans": 1 },
            { "title": "C", "q": "What will be the output?\nint x = 10; printf(\"%d %d %d\", x, x++, ++x);", "opts": ["10 10 12", "10 11 12", "Undefined behavior", "Compilation error"], "ans": 2 },
            { "title": "C", "q": "What is the output?\nint arr[] = {1,2,3,4}; printf(\"%d\", *(arr + 2));", "opts": ["2", "3", "4", "1"], "ans": 1 },
            { "title": "C", "q": "What will happen if free() is called twice on the same pointer?", "opts": ["No problem", "Compilation error", "Undefined behavior", "Memory increases"], "ans": 2 },
            { "title": "C", "q": "What will be the output?\nint x = 5; if(x = 0) printf(\"True\"); else printf(\"False\");", "opts": ["True", "False", "0", "Error"], "ans": 2 },
            { "title": "C", "q": "What is the default return type of a function in modern C (C99 and later) if not specified?", "opts": ["int", "float", "void", "Compilation error"], "ans": 3 },
            { "title": "C", "q": "What will be the output?\nint a = 5; printf(\"%d\", sizeof(a++));", "opts": ["5", "4", "6", "Undefined"], "ans": 1 },
            { "title": "C", "q": "Which storage class makes a variable retain its value between function calls?", "opts": ["auto", "register", "static", "extern"], "ans": 2 },
            { "title": "C", "q": "What will be the output?\nint *p = NULL; printf(\"%d\", *p);", "opts": ["0", "Garbage value", "Segmentation fault / Runtime error", "Compilation error"], "ans": 2 },

            // Html Questions
            { "title": "Html", "q": "What does HTML stand for?", "opts": ["Hyper Text Markup Language", "High Text Machine Language", "Hyperlink and Text Markup Language", "Home Tool Markup Language"], "ans": 0 },
            { "title": "Html", "q": "Which tag is used to create a paragraph in HTML?", "opts": ["<para>", "<p>", "<paragraph>", "<text>"], "ans": 1 },
            { "title": "Html", "q": "Which tag is used to insert an image?", "opts": ["<img>", "<image>", "<src>", "<pic>"], "ans": 0 },
            { "title": "Html", "q": "Which HTML tag is used to create a hyperlink?", "opts": ["<link>", "<a>", "<href>", "<hyper>"], "ans": 1 },
            { "title": "Html", "q": "Which tag is used to create a line break?", "opts": ["<lb>", "<break>", "<br>", "<line>"], "ans": 2 },
            { "title": "Html", "q": "Which attribute is used to provide an alternate text for an image?", "opts": ["title", "alt", "src", "href"], "ans": 1 },
            { "title": "Html", "q": "Which tag is used to create an ordered list?", "opts": ["<ul>", "<ol>", "<li>", "<dl>"], "ans": 1 },
            { "title": "Html", "q": "What is the correct HTML element for inserting a background color?", "opts": ["<body bg=\"yellow\">", "<background>", "CSS is used", "<color>"], "ans": 2 },
            { "title": "Html", "q": "Which tag is used to create a table row?", "opts": ["<td>", "<tr>", "<th>", "<row>"], "ans": 1 },
            { "title": "Html", "q": "Which input type is used for a password field?", "opts": ["text", "password", "secure", "hidden"], "ans": 1 },
            { "title": "Html", "q": "Which tag is used to define the largest heading?", "opts": ["<head>", "<h6>", "<heading>", "<h1>"], "ans": 3 },
            { "title": "Html", "q": "Which attribute is used to open a link in a new tab?", "opts": ["new", "open", "target=\"_blank\"", "tab"], "ans": 2 },
            { "title": "Html", "q": "What will be the output?\n<p>5 &lt; 10</p>", "opts": ["5 < 10", "5 < 10", "Error", "Nothing displayed"], "ans": 0 },
            { "title": "Html", "q": "Which tag is used to embed JavaScript inside HTML?", "opts": ["<javascript>", "<script>", "<js>", "<code>"], "ans": 1 },
            { "title": "Html", "q": "What is the correct way to define a form that sends data using POST method?", "opts": ["<form method=\"post\">", "<form type=\"post\">", "<form action=\"post\">", "<form send=\"post\">"], "ans": 0 },
            { "title": "Html", "q": "Which attribute makes an input field mandatory?", "opts": ["validate", "required", "mandatory", "mustfill"], "ans": 1 },
            { "title": "Html", "q": "Which tag is used for semantic navigation section?", "opts": ["<nav>", "<navigate>", "<menu>", "<section>"], "ans": 0 },
            { "title": "Html", "q": "What does the defer attribute in <script> tag do?", "opts": ["Stops script execution", "Executes script before HTML loads", "Executes script after HTML is parsed", "Deletes the script"], "ans": 2 },
            { "title": "Html", "q": "Which tag is used to define metadata about an HTML document?", "opts": ["<meta>", "<data>", "<info>", "<headinfo>"], "ans": 0 },
            { "title": "Html", "q": "What will happen if two elements have the same id in an HTML document?", "opts": ["Compilation error", "Page will not load", "HTML allows it but it is invalid and may cause issues in CSS/JS", "Browser crashes"], "ans": 2 },

            // Sql Questions
            { "title": "Sql", "q": "What does SQL stand for?", "opts": ["Structured Query Language", "Simple Query Language", "Standard Question Language", "System Query Logic"], "ans": 0 },
            { "title": "Sql", "q": "Which command is used to retrieve data from a table?", "opts": ["GET", "SELECT", "FETCH", "OPEN"], "ans": 1 },
            { "title": "Sql", "q": "Which clause is used to filter records?", "opts": ["ORDER BY", "WHERE", "GROUP BY", "LIMIT"], "ans": 1 },
            { "title": "Sql", "q": "Which command adds new records to a table?", "opts": ["ADD", "INSERT", "UPDATE", "CREATE"], "ans": 1 },
            { "title": "Sql", "q": "Which command deletes records from a table?", "opts": ["REMOVE", "DELETE", "DROP", "CLEAR"], "ans": 1 },
            { "title": "Sql", "q": "Which command modifies existing data?", "opts": ["MODIFY", "ALTER", "UPDATE", "CHANGE"], "ans": 2 },
            { "title": "Sql", "q": "Which keyword removes duplicate rows?", "opts": ["UNIQUE", "DISTINCT", "FILTER", "GROUP"], "ans": 1 },
            { "title": "Sql", "q": "Which clause sorts the result set?", "opts": ["SORT BY", "ORDER BY", "GROUP BY", "ARRANGE"], "ans": 1 },
            { "title": "Sql", "q": "Which function counts rows?", "opts": ["SUM()", "COUNT()", "TOTAL()", "NUMBER()"], "ans": 1 },
            { "title": "Sql", "q": "Which SQL command creates a table?", "opts": ["NEW TABLE", "CREATE TABLE", "MAKE TABLE", "BUILD TABLE"], "ans": 1 },
            { "title": "Sql", "q": "What does PRIMARY KEY do?", "opts": ["Allows duplicates", "Uniquely identifies each record", "Deletes records", "Sorts data"], "ans": 1 },
            { "title": "Sql", "q": "Which constraint prevents NULL values?", "opts": ["UNIQUE", "NOT NULL", "CHECK", "DEFAULT"], "ans": 1 },
            { "title": "Sql", "q": "Which command removes a table permanently?", "opts": ["DELETE TABLE", "REMOVE TABLE", "DROP TABLE", "CLEAR TABLE"], "ans": 2 },
            { "title": "Sql", "q": "Which clause groups rows with same values?", "opts": ["GROUP BY", "ORDER BY", "WHERE", "SORT"], "ans": 0 },
            { "title": "Sql", "q": "Which operator is used for pattern matching?", "opts": ["MATCH", "LIKE", "SEARCH", "FIND"], "ans": 1 },
            { "title": "Sql", "q": "Which keyword joins tables?", "opts": ["CONNECT", "JOIN", "MERGE", "LINK"], "ans": 1 },
            { "title": "Sql", "q": "What is a FOREIGN KEY?", "opts": ["Unique identifier", "Reference to another table", "Delete command", "Index type"], "ans": 1 },
            { "title": "Sql", "q": "Which clause filters grouped data?", "opts": ["WHERE", "HAVING", "ORDER BY", "LIMIT"], "ans": 1 },
            { "title": "Sql", "q": "Which statement changes table structure?", "opts": ["UPDATE", "ALTER TABLE", "MODIFY TABLE", "CHANGE"], "ans": 1 },
            { "title": "Sql", "q": "Which command removes all records but keeps table?", "opts": ["DELETE", "DROP", "TRUNCATE", "CLEAR"], "ans": 2 },

            // JavaScript Questions
            { "title": "JavaScript", "q": "Who developed JavaScript?", "opts": ["Dennis Ritchie", "Brendan Eich", "James Gosling", "Guido van Rossum"], "ans": 1 },
            { "title": "JavaScript", "q": "Which keyword declares a variable with block scope?", "opts": ["var", "let", "define", "constvar"], "ans": 1 },
            { "title": "JavaScript", "q": "Which symbol is used for single-line comments?", "opts": ["#", "//", "<!--", "**"], "ans": 1 },
            { "title": "JavaScript", "q": "Which data type represents true/false values?", "opts": ["Number", "Boolean", "String", "Object"], "ans": 1 },
            { "title": "JavaScript", "q": "Which function prints output to browser console?", "opts": ["print()", "echo()", "console.log()", "log()"], "ans": 2 },
            { "title": "JavaScript", "q": "Which operator checks both value and type?", "opts": ["==", "=", "===", "!="], "ans": 2 },
            { "title": "JavaScript", "q": "Which keyword defines a function?", "opts": ["func", "function", "def", "method"], "ans": 1 },
            { "title": "JavaScript", "q": "What is the correct file extension for JavaScript?", "opts": [".js", ".java", ".script", ".ts"], "ans": 0 },
            { "title": "JavaScript", "q": "Which method converts string to number?", "opts": ["Number()", "parseInt()", "Both A and B", "convert()"], "ans": 2 },
            { "title": "JavaScript", "q": "What is an array in JavaScript?", "opts": ["Single value", "Collection of values", "Function", "Object only"], "ans": 1 },
            { "title": "JavaScript", "q": "What is the output?\nconsole.log(typeof null);", "opts": ["null", "object", "undefined", "number"], "ans": 1 },
            { "title": "JavaScript", "q": "What is the output?\nconsole.log(\"5\" + 2);", "opts": ["7", "52", "Error", "5"], "ans": 1 },
            { "title": "JavaScript", "q": "Which keyword declares a constant?", "opts": ["const", "final", "constant", "fixed"], "ans": 0 },
            { "title": "JavaScript", "q": "What does NaN mean?", "opts": ["No assigned number", "Not a Number", "Null and None", "New array number"], "ans": 1 },
            { "title": "JavaScript", "q": "Which loop repeats while condition is true?", "opts": ["for", "while", "repeat", "loop"], "ans": 1 },
            { "title": "JavaScript", "q": "What is the output?\nconsole.log(2 + \"3\");", "opts": ["5", "23", "Error", "undefined"], "ans": 1 },
            { "title": "JavaScript", "q": "Which object represents the browser window?", "opts": ["document", "window", "screen", "navigator"], "ans": 1 },
            { "title": "JavaScript", "q": "Which method adds element to end of array?", "opts": ["push()", "add()", "append()", "insert()"], "ans": 0 },
            { "title": "JavaScript", "q": "What is the output?\nconsole.log(true + true);", "opts": ["0", "1", "2", "Error"], "ans": 2 },
            { "title": "JavaScript", "q": "Which keyword is used for conditional branching?", "opts": ["switch", "select", "choose", "option"], "ans": 0 }
        ];

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        async function init() {
            try {
                if (SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL_HERE') throw new Error("URL_NOT_SET");

                const res = await fetch(SCRIPT_URL + '?action=getQuestions');
                const data = await res.json();

                let baseQuestions = (data && data.questions && data.questions.length > 0) ? data.questions : fallbackQuestions;

                let categoriesMap = {};
                baseQuestions.forEach(q => {
                    let cat = q.title || 'General';
                    if (!categoriesMap[cat]) categoriesMap[cat] = [];
                    categoriesMap[cat].push(q);
                });

                let selectedQuestions = [];
                // Round 1 Distribution Requirements Layout
                const quota = { "Python": 10, "Java": 5, "C": 5, "Html": 5, "Sql": 3, "JavaScript": 2 };

                // Enforce STRICT category testing order
                const strictOrder = ["Python", "Java", "C", "Html", "Sql", "JavaScript"];
                uniqueCategories = [];
                currentCategoryIndex = 0;

                strictOrder.forEach(cat => {
                    if (categoriesMap[cat] && categoriesMap[cat].length > 0) {
                        uniqueCategories.push(cat);
                        let required = quota[cat] || 5;
                        let catArray = categoriesMap[cat];
                        shuffleArray(catArray);
                        selectedQuestions.push(...catArray.slice(0, required));
                    }
                });

                questions = selectedQuestions;
                userAnswers = new Array(questions.length).fill(null);

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('landing-screen').classList.remove('hidden');

            } catch (e) {
                console.warn("Error bootstrapping questions. Fallback loaded.");

                let categoriesMap = {};
                fallbackQuestions.forEach(q => {
                    let cat = q.title || 'General';
                    if (!categoriesMap[cat]) categoriesMap[cat] = [];
                    categoriesMap[cat].push(q);
                });

                let selectedQuestions = [];
                const quota = { "Python": 10, "Java": 5, "C": 5, "Html": 5, "Sql": 3, "JavaScript": 2 };

                const strictOrder = ["Python", "Java", "C", "Html", "Sql", "JavaScript"];
                uniqueCategories = [];
                currentCategoryIndex = 0;

                strictOrder.forEach(cat => {
                    if (categoriesMap[cat] && categoriesMap[cat].length > 0) {
                        uniqueCategories.push(cat);
                        let required = quota[cat] || 5;
                        let catArray = categoriesMap[cat];
                        shuffleArray(catArray);
                        selectedQuestions.push(...catArray.slice(0, required));
                    }
                });

                questions = selectedQuestions;
                userAnswers = new Array(questions.length).fill(null);

                document.getElementById('loading').classList.add('hidden');
                document.getElementById('landing-screen').classList.remove('hidden');
            }
        }

        document.getElementById('enter-fullscreen-btn').addEventListener('click', () => {
            requestFullscreen();
            document.getElementById('landing-error').classList.add('hidden');
            document.getElementById('landing-screen').classList.add('hidden');
            if (isDeskLocked) {
                document.getElementById('quiz-screen').classList.remove('hidden');
            } else {
                document.getElementById('start-screen').classList.remove('hidden');
            }
        });

        document.getElementById('start-btn').addEventListener('click', () => {
            const name = document.getElementById('name').value.trim();
            const college = document.getElementById('college').value.trim();
            const dept = document.getElementById('dept').value.trim();
            const mail = document.getElementById('mail').value.trim();
            const phone = document.getElementById('phone').value.trim();

            if (!name || !college || !dept || !mail || !phone) {
                document.getElementById('start-error').classList.remove('hidden');
                return;
            }

            if (!document.fullscreenElement) {
                requestFullscreen();
            }

            document.getElementById('start-screen').classList.add('hidden');
            renderQuiz();
            startTimer();
            document.getElementById('quiz-screen').classList.remove('hidden');

            setTimeout(() => { isDeskLocked = true; }, 1000); // Activate desk lock
        });

        function requestFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => console.log(err));
            } else if (elem.mozRequestFullScreen) { /* Firefox */
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) { /* IE/Edge */
                elem.msRequestFullscreen();
            }
        }

        // Desk Lock security features
        document.addEventListener("fullscreenchange", () => {
            if (!document.fullscreenElement) {
                if (isDeskLocked && !document.getElementById('quiz-screen').classList.contains('hidden')) {
                    document.getElementById('quiz-screen').classList.add('hidden');
                    document.getElementById('landing-screen').classList.remove('hidden');

                    const errElem = document.getElementById('landing-error');
                    errElem.textContent = ">> COMPLIANCE_ERROR: Full-screen mode exited. You must return to full-screen to continue the test. Timer is still running.";
                    errElem.classList.remove('hidden');
                } else if (!document.getElementById('start-screen').classList.contains('hidden')) {
                    // If they exit fullscreen while filling out their info before the test
                    document.getElementById('start-screen').classList.add('hidden');
                    document.getElementById('landing-screen').classList.remove('hidden');

                    const errElem = document.getElementById('landing-error');
                    errElem.textContent = ">> COMPLIANCE_ERROR: Full-screen mode is strictly required to proceed.";
                    errElem.classList.remove('hidden');
                }
            }
        });

        window.addEventListener("blur", () => {
            if (isDeskLocked && !document.getElementById('quiz-screen').classList.contains('hidden')) {
                document.getElementById('quiz-screen').classList.add('hidden');
                document.getElementById('landing-screen').classList.remove('hidden');

                const errElem = document.getElementById('landing-error');
                errElem.textContent = ">> COMPLIANCE_ERROR: Window focus lost. You must return to full-screen to continue the test. Timer is still running.";
                errElem.classList.remove('hidden');
            }
        });

        // Block Right-Click Context Menu
        document.addEventListener('contextmenu', event => {
            if (isDeskLocked) event.preventDefault();
        });

        // Block Refresh, DevTools, Copy-Paste, Back/Forward shortcuts, and Escape
        document.addEventListener('keydown', (e) => {
            if (isDeskLocked) {
                // Trap ESCAPE explicitly
                if (e.key === 'Escape' || e.keyCode === 27) {
                    e.preventDefault();
                    return false;
                }

                // F5, Ctrl+R, F12, Ctrl+Shift+I
                if (e.key === 'F5' || (e.ctrlKey && e.key.toLowerCase() === 'r') || e.key === 'F12' || (e.ctrlKey && e.shiftKey && e.key.toLowerCase() === 'i')) {
                    e.preventDefault();
                }
                // Alt+Left / Alt+Right
                if (e.altKey && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
                    e.preventDefault();
                }
                // Ctrl+C, Ctrl+V, Ctrl+U (View Source)
                if (e.ctrlKey && (e.key.toLowerCase() === 'c' || e.key.toLowerCase() === 'v' || e.key.toLowerCase() === 'u')) {
                    e.preventDefault();
                }
            }
        });

        function startTimer() {
            let timeLeft = 30 * 60; // 30 minutes in seconds
            const timerDisplay = document.getElementById('timer-display');
            updateTimerDisplay(timeLeft, timerDisplay);

            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft, timerDisplay);

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    timerDisplay.textContent = "[ TIME_OUT // ENFORCING_SUBMIT ]";
                    submitQuiz(true); // Auto submit when time is up
                }
            }, 1000);
        }

        function updateTimerDisplay(seconds, display) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            display.textContent = `[ T-MINUS: ${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')} ]`;

            if (seconds <= 300) { // Last 5 minutes
                display.style.color = '#ef4444';
                display.style.borderColor = '#ef4444';
                display.style.boxShadow = '0 0 15px rgba(239, 68, 68, 0.4)';
                display.style.textShadow = '0 0 5px #ef4444';
            }
        }

        function renderQuiz() {
            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            if (uniqueCategories.length === 0) return;

            const currentCat = uniqueCategories[currentCategoryIndex];
            document.getElementById('category-title').textContent = `> SECTION: ${currentCat}`;

            let absoluteIndex = 0; // Tracks the visual question number internally per category if needed, but we keep the global mapping.

            questions.forEach((qObj, qIndex) => {
                if ((qObj.title || 'General') !== currentCat) return;

                const card = document.createElement('div');
                card.className = 'card';

                const qTitle = document.createElement('div');
                qTitle.style.marginBottom = '15px';
                qTitle.style.fontSize = '1.2rem';
                qTitle.style.lineHeight = '1.5';
                qTitle.innerHTML = `<span style="color: var(--primary);">[Q${absoluteIndex + 1}]</span> <br><br> ${qObj.q}`;
                card.appendChild(qTitle);

                absoluteIndex++;

                qObj.opts.forEach((opt, oIndex) => {
                    const label = document.createElement('label');
                    label.className = 'option';

                    const input = document.createElement('input');
                    input.type = 'radio';
                    input.name = `q_${qIndex}`; // Safe: links direct absolute pos
                    input.value = oIndex;

                    // Recover answered state when navigating back and forth!
                    if (userAnswers[qIndex] === oIndex) {
                        input.checked = true;
                        label.classList.add('selected');
                    }

                    input.addEventListener('change', () => {
                        userAnswers[qIndex] = oIndex;
                        const siblings = card.querySelectorAll('.option');
                        siblings.forEach(s => s.classList.remove('selected'));
                        label.classList.add('selected');
                    });

                    label.appendChild(input);
                    label.appendChild(document.createTextNode(` > ${opt}`));
                    card.appendChild(label);
                });

                container.appendChild(card);
            });

            // Render Pagination Logic
            document.getElementById('prev-btn').classList.toggle('hidden', currentCategoryIndex === 0);

            if (currentCategoryIndex < uniqueCategories.length - 1) {
                document.getElementById('next-btn').classList.remove('hidden');
                document.getElementById('submit-btn').classList.add('hidden');
            } else {
                document.getElementById('next-btn').classList.add('hidden');
                document.getElementById('submit-btn').classList.remove('hidden');
            }
        }

        document.getElementById('next-btn').addEventListener('click', () => {
            currentCategoryIndex++;
            renderQuiz();
            window.scrollTo(0, 0);
        });

        document.getElementById('prev-btn').addEventListener('click', () => {
            currentCategoryIndex--;
            renderQuiz();
            window.scrollTo(0, 0);
        });

        document.getElementById('submit-btn').addEventListener('click', () => {
            submitQuiz(false);
        });

        async function submitQuiz(isAutoSubmit = false) {
            if (!isAutoSubmit && userAnswers.includes(null)) {
                document.getElementById('submit-error').classList.remove('hidden');
                return;
            }

            isDeskLocked = false; // Disable security checks once submitting
            clearInterval(timerInterval); // Stop timer
            document.getElementById('submit-error').classList.add('hidden');

            let score = 0;
            userAnswers.forEach((ans, i) => {
                if (ans !== null && ans == questions[i].ans) score++;
            });

            const name = document.getElementById('name').value.trim();
            const college = document.getElementById('college').value.trim();
            const dept = document.getElementById('dept').value.trim();
            const mail = document.getElementById('mail').value.trim();
            const phone = document.getElementById('phone').value.trim();

            document.getElementById('submit-btn').classList.add('hidden');
            document.getElementById('prev-btn').classList.add('hidden');
            document.getElementById('next-btn').classList.add('hidden');

            // New animated loader
            document.getElementById('submit-loader').classList.remove('hidden');
            let progressSpan = document.getElementById('progress-bar');
            let dots = 0;
            let loadingAnim = setInterval(() => {
                dots++;
                let filled = Array(Math.min(dots, 10)).fill('#').join('');
                let empty = Array(Math.max(10 - dots, 0)).fill('.').join('');
                progressSpan.textContent = `[${filled}${empty}]`;
            }, 100);

            try {
                if (SCRIPT_URL !== 'YOUR_APPS_SCRIPT_URL_HERE') {
                    await fetch(SCRIPT_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                        body: `action=submitScore&name=${encodeURIComponent(name)}&college=${encodeURIComponent(college)}&dept=${encodeURIComponent(dept)}&mail=${encodeURIComponent(mail)}&phone=${encodeURIComponent(phone)}&score=${score}&total=${questions.length}`
                    });
                }
            } catch (e) {
                // Because Apps Script POST redirects, a CORS error occurs on the UI layer, 
                // but the payload is still delivered to Google Sheets!
                console.log("POST request completed (ignoring CORS opaque response).");
            }

            clearInterval(loadingAnim);

            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('res-name').textContent = name;
            document.getElementById('res-score').textContent = score;
            document.getElementById('res-total').textContent = questions.length;

            if (isAutoSubmit) {
                document.querySelector('#result-screen h2').textContent = "> TIME_OUT // AUTO_SUBMITTED";
                document.querySelector('#result-screen h2').style.color = "#ef4444";
            }

            document.getElementById('result-screen').classList.remove('hidden');
            window.scrollTo(0, 0);

            // Exit fullscreen mode after submission
            if (document.fullscreenElement) {
                if (document.exitFullscreen) {
                    document.exitFullscreen().catch(err => console.log(err));
                } else if (document.mozCancelFullScreen) { /* Firefox */
                    document.mozCancelFullScreen();
                } else if (document.webkitExitFullscreen) { /* Chrome, Safari and Opera */
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) { /* IE/Edge */
                    document.msExitFullscreen();
                }
            }
        }

        async function viewScores() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('scores-screen').classList.remove('hidden');
            const tbody = document.querySelector('#public-scores-table tbody');
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">Fetching leaderboard...</td></tr>';
            try {
                if (SCRIPT_URL === 'YOUR_APPS_SCRIPT_URL_HERE' && false) {
                    tbody.innerHTML = '<tr><td colspan="3" style="text-align:center;">URL Not Set</td></tr>';
                    return;
                }
                const res = await fetch(SCRIPT_URL + '?action=getScores');
                const data = await res.json();
                tbody.innerHTML = '';
                if (!data.scores || data.scores.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="3">No public records found.</td></tr>';
                    return;
                }

                // Sort scores descending based on score parsing where result is "score / total"
                data.scores.sort((a, b) => {
                    const sa = parseInt(a.result.split('/')[0]) || 0;
                    const sb = parseInt(b.result.split('/')[0]) || 0;
                    return sb - sa;
                });

                data.scores.forEach((s, idx) => {
                    tbody.innerHTML += `<tr>
                        <td style="padding:10px; border-bottom:1px solid var(--border); color:var(--text-muted);">${idx + 1}</td>
                        <td style="padding:10px; border-bottom:1px solid var(--border);">${s.name.replace(/</g, "&lt;")}</td>
                        <td style="padding:10px; border-bottom:1px solid var(--border); font-weight:bold; color:var(--primary);">${s.result}</td>
                    </tr>`;
                });
            } catch (e) {
                tbody.innerHTML = '<tr><td colspan="3" style="color:#ef4444;text-align:center;">Network Error</td></tr>';
            }
        }

        function closeScores() {
            document.getElementById('scores-screen').classList.add('hidden');
            if (userAnswers.includes(null) || userAnswers.length === 0) {
                document.getElementById('start-screen').classList.remove('hidden');
            } else {
                document.getElementById('result-screen').classList.remove('hidden');
            }
        }

        init();
    </script>
</body>

</html>