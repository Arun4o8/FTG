<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Round 2: Technical Challenge</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

        :root {
            --bg-color: #000000;
            --text-color: #00ff00;
            --container-bg: #0a0a0a;
            --border-color: #00ff00;
            --primary-color: #00ff00;
            --editor-bg: #050505;
            --editor-text: #00ff00;
            --error-color: #ff0033;
            --success-color: #00ff00;
            --glow: 0 0 10px rgba(0, 255, 0, 0.5);
            --font-family: 'Share Tech Mono', 'Courier New', monospace;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            user-select: none;
            /* Prevent cheating/highlighting */
        }

        /* Allow typing and selecting inside inputs/editors ONLY */
        input,
        select,
        textarea {
            user-select: text !important;
        }

        /* Matrix rain animated background effect styles */
        .matrix-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            opacity: 0.15;
            background: repeating-linear-gradient(0deg,
                    rgba(0, 0, 0, 0.15),
                    rgba(0, 0, 0, 0.15) 1px,
                    transparent 1px,
                    transparent 2px);
        }

        .container {
            width: 100%;
            max-width: 900px;
            background-color: var(--container-bg);
            padding: 30px;
            border-radius: 5px;
            border: 1px solid var(--border-color);
            box-shadow: var(--glow);
            box-sizing: border-box;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px dashed var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 25px;
        }

        h1 {
            color: var(--primary-color);
            margin: 0;
            font-size: 1.8rem;
            text-shadow: var(--glow);
            text-transform: uppercase;
        }

        .timer-container {
            font-size: 1.4rem;
            font-weight: bold;
            background-color: #001a00;
            padding: 10px 20px;
            border-radius: 3px;
            border: 1px solid var(--primary-color);
            color: var(--primary-color);
            box-shadow: inset 0 0 10px rgba(0, 255, 0, 0.2);
            animation: pulse-border 2s infinite;
        }

        @keyframes pulse-border {
            0% {
                box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.2), 0 0 5px rgba(0, 255, 0, 0.2);
            }

            50% {
                box-shadow: inset 0 0 15px rgba(0, 255, 0, 0.5), 0 0 15px rgba(0, 255, 0, 0.5);
            }

            100% {
                box-shadow: inset 0 0 5px rgba(0, 255, 0, 0.2), 0 0 5px rgba(0, 255, 0, 0.2);
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        input[type="text"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 12px;
            border-radius: 3px;
            border: 1px solid #005500;
            background-color: #000;
            color: var(--text-color);
            font-size: 1.1rem;
            font-family: var(--font-family);
            box-sizing: border-box;
            transition: all 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(0, 255, 0, 0.4);
        }

        .question-section {
            background-color: #050a05;
            padding: 25px;
            border-radius: 5px;
            margin-bottom: 30px;
            border: 1px solid #004400;
            position: relative;
        }

        .question-section::before {
            content: '>';
            position: absolute;
            left: 10px;
            top: 25px;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.3rem;
        }

        h2 {
            font-size: 1.4rem;
            margin-top: 0;
            margin-left: 20px;
            color: var(--primary-color);
            border-bottom: 1px dashed #004400;
            padding-bottom: 10px;
            text-transform: uppercase;
        }

        p.problem-statement {
            font-size: 1.1rem;
            line-height: 1.5;
            color: #ccc;
            margin-left: 20px;
        }

        .editor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: #0a1f0a;
            padding: 5px 15px;
            border: 1px solid var(--border-color);
            border-bottom: none;
            border-radius: 3px 3px 0 0;
        }

        .editor-header label {
            margin-bottom: 0;
            font-size: 1rem;
        }

        .editor-header select {
            width: auto;
            padding: 5px 10px;
            font-size: 1rem;
            background-color: #000;
        }

        textarea.editor {
            width: 100%;
            height: 250px;
            background-color: var(--editor-bg);
            color: var(--editor-text);
            font-family: var(--font-family);
            padding: 15px;
            border-radius: 0 0 3px 3px;
            border: 1px solid var(--border-color);
            box-sizing: border-box;
            resize: vertical;
            font-size: 1.1rem;
            line-height: 1.4;
        }

        pre.code-block {
            background-color: var(--editor-bg);
            color: #ccc;
            padding: 15px;
            border-radius: 3px;
            font-family: var(--font-family);
            border: 1px dashed #004400;
            border-left: 4px solid var(--primary-color);
            white-space: pre-wrap;
            font-size: 1.1rem;
            margin-bottom: 15px;
        }

        .action-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
        }

        .btn-run {
            background-color: transparent;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
            padding: 8px 15px;
            font-family: var(--font-family);
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-run:hover {
            background-color: var(--primary-color);
            color: #000;
            box-shadow: var(--glow);
        }

        .btn-run:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .output-box {
            margin-top: 15px;
            background-color: #000;
            border: 1px dashed #005500;
            padding: 15px;
            font-size: 1rem;
            color: #ccc;
            min-height: 50px;
            white-space: pre-wrap;
            display: none;
        }

        button.submit-btn {
            background-color: var(--primary-color);
            color: #000;
            border: none;
            padding: 15px 25px;
            font-family: var(--font-family);
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 3px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            margin-top: 20px;
        }

        button.submit-btn:hover {
            background-color: #39ff14;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.6);
            transform: translateY(-2px);
        }

        button.submit-btn.loading {
            opacity: 0.7;
            cursor: wait;
            animation: pulse-border 1s infinite;
        }

        #thank-you-message {
            display: none;
            text-align: center;
            padding: 50px 20px;
        }

        #thank-you-message h2 {
            border: none;
            color: var(--primary-color);
            font-size: 2.5rem;
            margin-bottom: 15px;
            text-shadow: var(--glow);
        }

        #thank-you-message p {
            font-size: 1.3rem;
            color: #aaa;
        }

        .hidden {
            display: none !important;
        }

        #landing-screen {
            text-align: center;
            max-width: 600px;
            margin: 50px auto;
            position: relative;
            z-index: 100;
        }

        #landing-screen h2 {
            border: none;
            font-size: 2rem;
            margin-bottom: 20px;
        }

        #landing-screen p {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 30px;
            line-height: 1.5;
        }

        #landing-error {
            color: var(--error-color);
            border: 1px solid var(--error-color);
            padding: 15px;
            margin-bottom: 25px;
            font-weight: bold;
            background: rgba(255, 0, 51, 0.1);
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .timer-container {
                width: 100%;
                box-sizing: border-box;
            }
        }
    </style>
</head>

<body>

    <div class="matrix-bg"></div>

    <!-- Landing Screen -->
    <div id="landing-screen" class="container">
        <h2>> SECURE_TEST_ENVIRONMENT</h2>
        <div id="landing-error" class="hidden"></div>
        <p>Please enter full-screen mode to access the Hack The Terminal challenge. If you attempt to switch tabs or
            exit fullscreen, the terminal will lock you out.</p>
        <button type="button" class="submit-btn" id="enter-fullscreen-btn">> ENTER_FULLSCREEN_MODE</button>
    </div>

    <div class="container hidden" id="main-container">
        <form id="challenge-form">
            <header>
                <h1>[ ROUND 2 : HACK THE TERMINAL ]</h1>
                <div class="timer-container">
                    T-MINUS: <span id="timer">45:00</span>
                </div>
            </header>

            <div class="form-group">
                <label for="studentName">> Student Name_</label>
                <input type="text" id="studentName" name="studentName" required placeholder="Enter your full name"
                    autocomplete="off">
            </div>

            <div class="form-group">
                <label for="collegeName">> College Name_</label>
                <input type="text" id="collegeName" name="collegeName" required placeholder="Enter your college"
                    autocomplete="off">
            </div>

            <div class="form-group">
                <label for="phoneNumber">> Phone Number_</label>
                <input type="tel" id="phoneNumber" name="phoneNumber" required placeholder="Enter valid phone number"
                    autocomplete="off">
            </div>

            <div id="questions-container"></div>
            <button type="submit" id="submit-btn" class="submit-btn">> SUBMIT_SYS.DATA </button>
        </form>

        <div id="thank-you-message">
            <h2>[ âœ” ALGORITHM COMPLETED ]</h2>
            <p>Data packets successfully transmitted to host server.</p>
            <p style="color: var(--primary); font-size: 1.5rem; margin-top: 20px;">> PLEASE WAIT FOR THE RESULTS.</p>
        </div>
    </div>

    <script>
        // --- Countdown Timer ---
        let timeRemaining = 45 * 60; // 45 mins
        const timerElement = document.getElementById('timer');
        let timerInterval;

        function updateTimer() {
            let minutes = Math.floor(timeRemaining / 60);
            let seconds = timeRemaining % 60;
            minutes = minutes < 10 ? '0' + minutes : minutes;
            seconds = seconds < 10 ? '0' + seconds : seconds;
            timerElement.textContent = `${minutes}:${seconds}`;

            if (timeRemaining <= 180) { // last 3 mins red alert
                timerElement.style.color = '#ff0033';
                timerElement.style.borderColor = '#ff0033';
            }

            if (timeRemaining <= 0) {
                clearInterval(timerInterval);
                timerElement.textContent = "00:00";
                alert("TIME LIMIT REACHED. Forcing submission protocol.");
                document.getElementById('challenge-form').requestSubmit();
            }
            timeRemaining--;
        }

        timerInterval = setInterval(updateTimer, 1000);
        updateTimer();


        // --- Dynamic Questions ---
        const questionsPool = [
            {
                title: "Spot the Defect",
                desc: "The program is supposed to calculate and print the Factorial of 5 but it is heavily broken with exactly 10 errors. Fix them all!",
                example: "Output: Factorial is 120",
                boilerplates: {
                    c: "#include <stdio.h>\nint main( { \n    int n = 5\n    int fact = 0; \n    for (int i=1, i<=n, i++) { \n        fact = fact * i \n    }\n    prntf(\"Factorial is %d\\n\", factorial); \n    if (fact = 120) { \n        printf(\"Correct\") \n    }\n    return 0 \n}",
                    java: "public class Main {\n    public void main(String[] args) { \n        int n = 5 \n        int fact = 0; \n        for (int i=1, i<=n, i++) { \n            fact = fact * i \n        }\n        System.out.putln(\"Fac: \" + factorial); \n        if (fact = 120) { \n            System.out.printl(\"Correct\") \n        }\n    }\n}",
                    python: "def calc_factorial():\n    n = 5\n    fact = 0 \n    for i in range(1, n) \n        fact = fact * i\n    print(\"Factorial is \" + factorial) \n    if fact = 120 \n        print(\"Correct\" \n    else \n        print(Wrong)\n\ncalc_factorial()"
                }
            },
            {
                title: "Missing Modules",
                desc: "Fill in the `____` blanks inside the loops so the logic accurately generates the first 5 Fibonacci numbers (0 1 1 2 3).",
                example: "Output: 0 1 1 2 3",
                boilerplates: {
                    c: "#include <stdio.h>\nint main() {\n    int n1=0, n2=1, n3, i, count=5;\n    printf(\"%d %d\", n1, n2);\n    for(i=2; i<count; ____) {\n        n3 = n1 + n2;\n        printf(\" %d\", n3);\n        n1 = ____;\n        n2 = ____;\n    }\n    return 0;\n}",
                    java: "public class Main {\n    public static void main(String[] args) {\n        int n1=0, n2=1, n3, i, count=5;\n        System.out.print(n1 + \" \" + n2);\n        for(i=2; i<count; ____) {\n            n3 = n1 + n2;\n            System.out.print(\" \" + n3);\n            n1 = ____;\n            n2 = ____;\n        }\n    }\n}",
                    python: "def print_fibo():\n    n1, n2 = 0, 1\n    count = 5\n    print(n1, n2, end=\" \")\n    for i in range(2, count):\n        n3 = n1 + n2\n        print(n3, end=\" \")\n        n1 = ____\n        n2 = ____\n\nprint_fibo()"
                }
            },
            {
                title: "Longest Common Prefix",
                desc: "Write a function to find the longest common prefix in an array of strings.",
                example: "Input: [\"flower\",\"flow\",\"flight\"]\nOutput: \"fl\"",
                boilerplates: {
                    c: "#include <stdio.h>\n#include <string.h>\n\nvoid longestCommonPrefix(char strs[][20], int n, char result[]) {\n    // Write your logic here\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static String longestCommonPrefix(String[] strs) {\n        // Write your logic here\n        return \"\";\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def longest_common_prefix(strs):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Reverse a String",
                desc: "Write a function to reverse a given string.",
                example: "Input: \"hello\"\nOutput: \"olleh\"",
                boilerplates: {
                    c: "#include <stdio.h>\n#include <string.h>\n\nvoid reverse(char str[]) {\n    // Write your logic here\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static String reverseString(String s) {\n        // Write your logic here\n        return \"\";\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def reverse_string(s):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Find Maximum Element",
                desc: "Write a function to find the largest number in an array.",
                example: "Input: [10, 5, 20, 8]\nOutput: 20",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint findMax(int arr[], int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int findMax(int[] arr) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def find_max(arr):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Check Palindrome",
                desc: "Write a function to check if a string is a palindrome.",
                example: "Input: \"madam\"\nOutput: True",
                boilerplates: {
                    c: "#include <stdio.h>\n#include <string.h>\n\nint isPalindrome(char str[]) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static boolean isPalindrome(String s) {\n        // Write your logic here\n        return false;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def is_palindrome(s):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Count Vowels",
                desc: "Write a function to count vowels in a string.",
                example: "Input: \"computer\"\nOutput: 3",
                boilerplates: {
                    c: "#include <stdio.h>\n#include <string.h>\n\nint countVowels(char str[]) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int countVowels(String s) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def count_vowels(s):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Factorial",
                desc: "Write a function to find the factorial of a number.",
                example: "Input: 5\nOutput: 120",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint factorial(int n) {\n    // Write your logic here\n    return 1;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int factorial(int n) {\n        // Write your logic here\n        return 1;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def factorial(n):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Remove Duplicates",
                desc: "Write a function to remove duplicate elements from an array.",
                example: "Input: [1,2,2,3,4]\nOutput: [1,2,3,4]",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint removeDuplicates(int arr[], int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "import java.util.Arrays;\n\npublic class Main {\n    static int[] removeDuplicates(int[] arr) {\n        // Write your logic here\n        return arr;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def remove_duplicates(arr):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Fibonacci Series",
                desc: "Write a function to print the first N Fibonacci numbers.",
                example: "Input: 5\nOutput: 0 1 1 2 3",
                boilerplates: {
                    c: "#include <stdio.h>\n\nvoid fibonacci(int n) {\n    // Write your logic here\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static void fibonacci(int n) {\n        // Write your logic here\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def fibonacci(n):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Check Prime",
                desc: "Write a function to check whether a number is prime.",
                example: "Input: 11\nOutput: True",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint isPrime(int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static boolean isPrime(int n) {\n        // Write your logic here\n        return false;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def is_prime(n):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Sum of Digits",
                desc: "Write a function to find the sum of digits.",
                example: "Input: 456\nOutput: 15",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint sumOfDigits(int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int sumOfDigits(int n) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def sum_of_digits(n):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Second Largest Number",
                desc: "Write a function to find the second largest number in an array.",
                example: "Input: [10,20,30,40]\nOutput: 30",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint secondLargest(int arr[], int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "import java.util.Arrays;\n\npublic class Main {\n    static int secondLargest(int[] arr) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def second_largest(arr):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Find Missing Number",
                desc: "Write a function to find the missing number from 1 to N.",
                example: "Input: [1,2,4,5]\nOutput: 3",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint missingNumber(int arr[], int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int missingNumber(int[] arr, int n) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def missing_number(arr, n):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Anagram Check",
                desc: "Write a function to check if two strings are anagrams.",
                example: "Input: \"listen\",\"silent\"\nOutput: True",
                boilerplates: {
                    c: "#include <stdio.h>\n#include <string.h>\n\nint isAnagram(char a[], char b[]) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "import java.util.Arrays;\n\npublic class Main {\n    static boolean isAnagram(String s1, String s2) {\n        // Write your logic here\n        return false;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def is_anagram(s1, s2):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Count Words",
                desc: "Write a function to count words in a sentence.",
                example: "Input: \"I love coding\"\nOutput: 3",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint countWords(char str[]) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int countWords(String s) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def count_words(s):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Armstrong Number",
                desc: "Write a function to check whether a number is an Armstrong number.",
                example: "Input: 153\nOutput: True",
                boilerplates: {
                    c: "#include <stdio.h>\n#include <math.h>\n\nint isArmstrong(int n) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static boolean isArmstrong(int n) {\n        // Write your logic here\n        return false;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def is_armstrong(n):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Sort an Array",
                desc: "Write a function to sort an array in ascending order.",
                example: "Input: [5,3,1,4]\nOutput: [1,3,4,5]",
                boilerplates: {
                    c: "#include <stdio.h>\n\nvoid sortArray(int arr[], int n) {\n    // Write your logic here\n}\n\nint main() {\n    return 0;\n}",
                    java: "import java.util.Arrays;\n\npublic class Main {\n    static void sortArray(int[] arr) {\n        // Write your logic here\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def sort_array(arr):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Find GCD",
                desc: "Write a function to find the GCD of two numbers.",
                example: "Input: 12,18\nOutput: 6",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint gcd(int a, int b) {\n    // Write your logic here\n    return 1;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int gcd(int a, int b) {\n        // Write your logic here\n        return 1;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def gcd(a, b):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Find LCM",
                desc: "Write a function to find the LCM of two numbers.",
                example: "Input: 4,6\nOutput: 12",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint lcm(int a, int b) {\n    // Write your logic here\n    return 1;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int lcm(int a, int b) {\n        // Write your logic here\n        return 1;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def lcm(a, b):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Character Frequency",
                desc: "Write a function to find the frequency of each character.",
                example: "Input: \"apple\"\nOutput: a:1, p:2, l:1, e:1",
                boilerplates: {
                    c: "#include <stdio.h>\n\nvoid charFrequency(char str[]) {\n    // Write your logic here\n}\n\nint main() {\n    return 0;\n}",
                    java: "import java.util.*;\n\npublic class Main {\n    static void charFrequency(String s) {\n        // Write your logic here\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def char_frequency(s):\n    # Write your logic here\n    pass\n"
                }
            },
            {
                title: "Binary to Decimal",
                desc: "Write a function to convert binary to decimal.",
                example: "Input: \"1010\"\nOutput: 10",
                boilerplates: {
                    c: "#include <stdio.h>\n\nint binaryToDecimal(char bin[]) {\n    // Write your logic here\n    return 0;\n}\n\nint main() {\n    return 0;\n}",
                    java: "public class Main {\n    static int binaryToDecimal(String b) {\n        // Write your logic here\n        return 0;\n    }\n    public static void main(String[] args) {\n    }\n}",
                    python: "def binary_to_decimal(b):\n    # Write your logic here\n    pass\n"
                }
            }
        ];

        const selectedQuestions = [];

        function loadQuestions() {
            // guarantee spot the defect is always here
            const spotDefect = questionsPool.find(q => q.title === "Spot the Defect");
            const missingMod = questionsPool.find(q => q.title === "Missing Modules");
            const others = questionsPool.filter(q => q.title !== "Spot the Defect" && q.title !== "Missing Modules").sort(() => 0.5 - Math.random());
            if (spotDefect) selectedQuestions.push(spotDefect);
            if (missingMod) selectedQuestions.push(missingMod);
            const remaining = 5 - selectedQuestions.length;
            if (remaining > 0) {
                selectedQuestions.push(...others.slice(0, remaining));
            }

            const container = document.getElementById('questions-container');
            container.innerHTML = '';

            selectedQuestions.forEach((q, idx) => {
                const i = idx + 1;
                // Important: Using template literal correctly escapes block formatting.
                container.innerHTML += `
                    <div class="question-section">
                        <h2>Q${i}: ${q.title}</h2>
                        <p class="problem-statement">
                            <strong>Objective:</strong> ${q.desc}<br><br>
                            <strong>Example:</strong><br>
                            <span style="white-space: pre-wrap;">${q.example}</span>
                        </p>
                        <div class="editor-header">
                            <label for="lang${i}">> Select Language:</label>
                            <select id="lang${i}" name="q${i}Language" required onchange="changeLanguage(${i})">
                                <option value="">-- Choose --</option>
                                <option value="c">C</option>
                                <option value="java">Java</option>
                                <option value="python">Python</option>
                            </select>
                        </div>
                        <textarea id="code${i}" name="q${i}Code" class="editor" required placeholder="Select language to load code..."></textarea>
                        <div class="action-row">
                            <button type="button" class="btn-run" onclick="runCode(${i})">[ Execute Code ]</button>
                            <span id="status${i}" style="color: yellow; font-size: 0.9em; display: none;">Executing...</span>
                        </div>
                        <div id="output${i}" class="output-box"></div>
                    </div>
                `;
            });

            const textareas = document.querySelectorAll('textarea.editor');
            textareas.forEach(ta => {
                ta.addEventListener('keydown', function (e) {
                    if (e.key === 'Tab') {
                        e.preventDefault();
                        const start = this.selectionStart;
                        const end = this.selectionEnd;
                        this.value = this.value.substring(0, start) + "    " + this.value.substring(end);
                        this.selectionStart = this.selectionEnd = start + 4;
                    }
                });
            });
        }

        function changeLanguage(i) {
            const lang = document.getElementById(`lang${i}`).value;
            const qIndex = i - 1;
            const editor = document.getElementById(`code${i}`);
            if (lang && selectedQuestions[qIndex].boilerplates[lang]) {
                if (!editor.value || Object.values(selectedQuestions[qIndex].boilerplates).includes(editor.value)) {
                    editor.value = selectedQuestions[qIndex].boilerplates[lang];
                }
            }
        }

        let questionScores = { q1: 0, q2: 0, q3: 0, q4: 0, q5: 0 };

        async function runCode(questionNumber) {
            const langValue = document.getElementById(`lang${questionNumber}`).value;
            const codeEditor = document.getElementById(`code${questionNumber}`).value;
            const outputBox = document.getElementById(`output${questionNumber}`);
            const statusSpan = document.getElementById(`status${questionNumber}`);

            if (!langValue) {
                alert("Please select a programming language first!");
                return;
            }
            if (codeEditor.trim() === '') {
                alert("Code editor is empty!");
                return;
            }

            outputBox.style.display = 'block';
            outputBox.textContent = '> Compiling code in live server...';
            statusSpan.style.display = 'inline';

            let languageId = 92; // Python 3.11 default
            if (langValue === 'c') languageId = 103; // C GCC 14.1
            else if (langValue === 'java') languageId = 91; // Java JDK 17

            try {
                const response = await fetch("https://ce.judge0.com/submissions?base64_encoded=false&wait=true", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        source_code: codeEditor,
                        language_id: languageId,
                    })
                });

                if (!response.ok) throw new Error("Live API failed");
                const result = await response.json();

                let actualOutput = result.stdout || "";
                let errorOutput = result.compile_output || result.stderr || result.message || "";
                let validationMessage = "";

                if (result.status.id === 3) {
                    let success = false;
                    const qIndex = questionNumber - 1;
                    const currentQuestion = selectedQuestions[qIndex];
                    if (currentQuestion && currentQuestion.title === "Spot the Defect") {
                        const code = codeEditor.toLowerCase().replace(/\s/g, '');
                        if (langValue === 'c') success = code.includes("main()") && !code.includes("prntf") && code.includes("==") && !code.includes("factorial)");
                        else if (langValue === 'java') success = code.includes("static") && code.includes("==") && !code.includes("putln") && !code.includes("printl") && !code.includes("factorial)");
                        else if (langValue === 'python') success = code.includes("fact=1") && code.includes("==") && code.includes("wrong");
                        else success = false;

                        if (success && actualOutput.includes("120")) {
                            success = true;
                            validationMessage = "\n> [+] System Analysis: Target output achieved. All defects neutralized.";
                        } else {
                            success = false;
                            validationMessage = "\n> [-] System Analysis: Executed, but logic still incorrect or defects remain.";
                        }
                    } else if (currentQuestion && currentQuestion.title === "Missing Modules") {
                        const code = codeEditor.replace(/\s/g, '');
                        if (langValue === 'c' || langValue === 'java') success = (!code.includes("____")) && code.includes("i++") && (code.includes("n1=n2;") || code.includes("n1=n2")) && (code.includes("n2=n3;") || code.includes("n2=n3"));
                        else if (langValue === 'python') success = (!code.includes("____")) && code.includes("n1=n2") && code.includes("n2=n3");
                        else success = false;

                        if (success && actualOutput.includes("0 1 1 2 3")) {
                            success = true;
                            validationMessage = "\n> [+] System Analysis: Modules linked successfully.";
                        } else {
                            success = false;
                            validationMessage = "\n> [-] System Analysis: Blanks filled, but output does not match first 5 fibonacci.";
                        }
                    } else {
                        let expectedOutput = "";
                        if (currentQuestion && currentQuestion.example) {
                            const outputMatch = currentQuestion.example.match(/Output:\s*(.*)/);
                            if (outputMatch && outputMatch[1]) {
                                expectedOutput = outputMatch[1].trim();
                            }
                        }

                        if (expectedOutput && actualOutput.trim() !== "" && (actualOutput.trim() === expectedOutput || actualOutput.trim().includes(expectedOutput))) {
                            success = true;
                            validationMessage = "\n> [+] System Analysis: Exact expected output generated.";
                        } else {
                            success = false;
                            validationMessage = "\n> [-] System Analysis: Executed, but output does not match exact expectations.";
                        }
                    }

                    if (success) {
                        questionScores[`q${questionNumber}`] = 4;
                    } else {
                        questionScores[`q${questionNumber}`] = 0;
                    }
                    outputBox.textContent = "--- COMPILE SUCCESS (LIVE) ---\n--- OUTPUT ---\n" + actualOutput + validationMessage;
                } else {
                    questionScores[`q${questionNumber}`] = 0;
                    outputBox.textContent = "--- " + result.status.description.toUpperCase() + " (LIVE) ---\n" + errorOutput + "\n> [-] System Analysis: Errors Detected.";
                }
            } catch (error) {
                setTimeout(() => {
                    questionScores[`q${questionNumber}`] = 0;
                    if (codeEditor.length > 25) {
                        outputBox.textContent = "--- COMPILE SUCCESS (FALLBACK) ---\n> [+] System Analysis: Code captured but output unverified. Score 0.";
                    } else {
                        outputBox.textContent = "--- ERROR (FALLBACK) ---\n> [-] System Analysis: Insufficient code volume. Score 0.";
                    }
                }, 1000);
            } finally {
                statusSpan.style.display = 'none';
            }
        }

        function autoValidateAll() {
            // Live execution determines the score now. No auto marks for length.
        }

        document.addEventListener('DOMContentLoaded', loadQuestions);

        // --- Form Submission Logic ---
        // REPLACE WITH YOUR ACTUAL GOOGLE SHEETS APP SCRIPT URL
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby4O4yRj0uBEL8qC1OaR2OSw8FTt1JWTuQqVxT3MD-2Nbo_qNwgvjL4SiFSpEDBA28G/exec';

        document.getElementById('challenge-form').addEventListener('submit', function (e) {
            e.preventDefault();

            const submitBtn = document.getElementById('submit-btn');
            submitBtn.innerHTML = '> UPLOADING PACKETS...';
            submitBtn.classList.add('loading');
            submitBtn.disabled = true;

            const formData = new FormData();
            formData.append('studentName', document.getElementById('studentName').value);
            formData.append('collegeName', document.getElementById('collegeName').value);
            formData.append('phoneNumber', document.getElementById('phoneNumber').value);

            // Calculate exact time taken for leaderboard speed checks
            const timeElapsedInSeconds = (45 * 60) - timeRemaining;
            let elapsedMins = Math.floor(timeElapsedInSeconds / 60);
            let elapsedSecs = timeElapsedInSeconds % 60;
            elapsedMins = elapsedMins < 10 ? '0' + elapsedMins : elapsedMins;
            elapsedSecs = elapsedSecs < 10 ? '0' + elapsedSecs : elapsedSecs;
            formData.append('time', `${elapsedMins} mins, ${elapsedSecs} secs`);

            for (let i = 1; i <= 5; i++) {
                if (document.getElementById('lang' + i)) {
                    formData.append('q' + i + 'Language', document.getElementById('lang' + i).value);
                    formData.append('q' + i + 'Code', document.getElementById('code' + i).value);
                }
            }

            autoValidateAll();

            const totalScore = questionScores.q1 + questionScores.q2 + questionScores.q3 + questionScores.q4 + questionScores.q5;
            formData.append('score', totalScore);

            // Generate detailed breakdown string
            const detailedMarks = `Q1=${questionScores.q1}/4\nQ2=${questionScores.q2}/4\nQ3=${questionScores.q3}/4\nQ4=${questionScores.q4}/4\nQ5=${questionScores.q5}/4\nTOTAL=${totalScore}/20`;
            formData.append('detailedMarks', detailedMarks);
            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                body: formData
            }).then(() => {
                document.getElementById('challenge-form').style.display = 'none';
                document.getElementById('thank-you-message').style.display = 'block';
                clearInterval(timerInterval);
                window.scrollTo(0, 0);
            }).catch(error => {
                console.error('Submission Error:', error);
                alert("> CRITICAL ERROR: Network failure submitting form. Please try again.");
                submitBtn.innerHTML = '> SUBMIT_SYS.DATA';
                submitBtn.classList.remove('loading');
                submitBtn.disabled = false;
            });
        });

        // Tab integration for textareas
        const textareas = document.querySelectorAll('textarea.editor');
        textareas.forEach(ta => {
            ta.addEventListener('keydown', function (e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    this.value = this.value.substring(0, start) + "    " + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + 4;
                }
            });
        });

        // --- Tab Lock & Fullscreen Functionality ---
        let isDeskLocked = false;

        document.getElementById('enter-fullscreen-btn').addEventListener('click', () => {
            requestFullscreen();
            document.getElementById('landing-error').classList.add('hidden');
            document.getElementById('landing-screen').classList.add('hidden');
            document.getElementById('main-container').classList.remove('hidden');
            setTimeout(() => { isDeskLocked = true; }, 1000);
        });

        function requestFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen().catch(err => console.log(err));
            } else if (elem.mozRequestFullScreen) {
                elem.mozRequestFullScreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }

        // Fullscreen Change Listener
        document.addEventListener("fullscreenchange", () => {
            if (!document.fullscreenElement) {
                if (isDeskLocked && !document.getElementById('main-container').classList.contains('hidden')) {
                    document.getElementById('main-container').classList.add('hidden');
                    document.getElementById('landing-screen').classList.remove('hidden');

                    const errElem = document.getElementById('landing-error');
                    errElem.innerHTML = ">> COMPLIANCE_ERROR: Full-screen mode exited.<br>You must return to full-screen to continue the test.<br>Timer is still running.";
                    errElem.classList.remove('hidden');
                }
            }
        });

        // Tab Switch / Blur Listener
        window.addEventListener("blur", () => {
            if (isDeskLocked && !document.getElementById('main-container').classList.contains('hidden')) {
                document.getElementById('main-container').classList.add('hidden');
                document.getElementById('landing-screen').classList.remove('hidden');

                const errElem = document.getElementById('landing-error');
                errElem.innerHTML = ">> COMPLIANCE_ERROR: Window focus lost.<br>Do not switch tabs or applications.<br>Return to full-screen mode to continue.";
                errElem.classList.remove('hidden');
            }
        });

        // Block Right-Click Context Menu
        document.addEventListener('contextmenu', event => {
            if (isDeskLocked) event.preventDefault();
        });

        // Block DevTools & Shortcuts
        document.addEventListener('keydown', (e) => {
            if (isDeskLocked) {
                if (e.key === 'Escape' || e.keyCode === 27) {
                    e.preventDefault();
                }
                // Block F12
                if (e.keyCode == 123) {
                    e.preventDefault();
                }
                // Block Ctrl+Shift+I / Ctrl+Shift+J / Ctrl+U
                if (e.ctrlKey && e.shiftKey && (e.keyCode == 73 || e.keyCode == 74)) {
                    e.preventDefault();
                }
                if (e.ctrlKey && e.keyCode == 85) {
                    e.preventDefault();
                }
                // Block Ctrl+C, Ctrl+V, Ctrl+X (just in case)
                if (e.ctrlKey && (e.key === 'c' || e.key === 'v' || e.key === 'x')) {
                    e.preventDefault();
                }
            }
        });

        // Block Copy, Cut, and Paste Events directly
        document.addEventListener('copy', (e) => {
            if (isDeskLocked) e.preventDefault();
        });
        document.addEventListener('cut', (e) => {
            if (isDeskLocked) e.preventDefault();
        });
        document.addEventListener('paste', (e) => {
            if (isDeskLocked) e.preventDefault();
        });

    </script>
</body>

</html>